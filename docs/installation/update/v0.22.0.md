---
layout: default
title: Update from < v0.22.0
parent: Update
grand_parent: Server Installation
nav_order: 1
---

# Updating to v0.22.0
{: .no_toc }

Since v0.22.0, the AliasVault docker structure has changed due to the introduction of the new (optional) all-in-one docker image that simplifies self-hosting use for NAS/Unraid and other home use. However we still advice to keep using the multi-docker setup for more flexibility, and this method stays fully supported as it makes managing your AliasVault instance more easy and gives you more control.

## Update Methods

### 1. Using install.sh

If you have AliasVault deployed using the official `install.sh`, you don't need to do anything. The automatic `install.sh update` will take care of all necessary data migrations for you.

```bash
./install.sh update
```

### 2. Manually installed

If you have manually installed AliasVault via a custom `docker-compose.yml` file or other stack such as Portainer, follow the following manual steps:

#### Step 1: Move secrets from .env to ./secrets folder

Create a new `./secrets` folder and move your secrets from environment variables to individual text files:

```bash
mkdir -p ./secrets
```

Create the following secret files with the specified permissions:

```bash
# Admin password hash (format: hash|timestamp)
echo "your_admin_password_hash|2024-01-01T00:00:00.0000000Z" > ./secrets/admin_password_hash
chmod 600 ./secrets/admin_password_hash

# Data protection certificate password
echo "your_data_protection_cert_password" > ./secrets/data_protection_cert_pass
chmod 600 ./secrets/data_protection_cert_pass

# JWT key
echo "your_jwt_key" > ./secrets/jwt_key
chmod 600 ./secrets/jwt_key

# PostgreSQL password
echo "your_postgres_password" > ./secrets/postgres_password
chmod 600 ./secrets/postgres_password
```

The final structure should look like:
```
-rw------- 1 root root  106 Aug  8 11:30 admin_password_hash
-rw------- 1 root root   44 Aug  7 22:46 data_protection_cert_pass
-rw------- 1 root root   44 Aug  7 22:46 jwt_key
-rw------- 1 root root   44 Aug  7 22:46 postgres_password
```

#### Step 2: Update docker-compose.yml

Update your `docker-compose.yml` to mount the new `./secrets` folder to `/secrets` in the `api` and `admin` containers:

```yaml
services:
  api:
    # ... other configuration
    volumes:
      - ./secrets:/secrets:ro
      # ... other volumes

  admin:
    # ... other configuration
    volumes:
      - ./secrets:/secrets:ro
      # ... other volumes
```

#### Step 3: Remove optional environment variables (optional)

You can optionally remove the following environment variables as they now fallback to default values:

- `Hostname` = empty (defaults to auto-detection)
- `Public registration enabled` = true (defaults to enabled)
- `IP logging` = true (defaults to enabled)

#### Step 4: Update and restart

Pull the latest images and restart your containers:

```bash
docker-compose pull
docker-compose down
docker-compose up -d
```

If you encounter any issues during the upgrade, please join the AliasVault Discord, create an issue on GitHub or contact us by email.
